document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("md-input"),t=document.getElementById("md-preview"),o=document.getElementById("copy-html");if(!e||!t||!o)return;if("undefined"==typeof marked||"undefined"==typeof DOMPurify){showAlert("Markdown libraries failed to load.","danger");return}marked.setOptions({gfm:!0,breaks:!0,headerIds:!1,mangle:!1});let n="",d=null;const r=()=>{const o=e.value||"",d=marked.parse(o),r=DOMPurify.sanitize(d);n=r,t.innerHTML=r,"function"==typeof trackToolUsage&&trackToolUsage("markdown_preview","render")},c=()=>{d&&window.clearTimeout(d),d=window.setTimeout(r,80)};e.addEventListener("input",c),o.addEventListener("click",()=>{copyToClipboard(n),"function"==typeof trackToolUsage&&trackToolUsage("markdown_preview","copy_html")}),e.value=e.value||"# Markdown\n\n- Rendered preview\n- Copy HTML\n\n```js\nconsole.log(\"Hello\");\n```\n",r()});