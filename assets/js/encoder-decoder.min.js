document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll('input[name="format"]'),t=document.getElementById("input-text"),n=document.getElementById("output-text"),o=document.getElementById("file-input"),r=document.getElementById("encode-btn"),c=document.getElementById("decode-btn"),d=document.getElementById("swap-btn"),a=document.getElementById("copy-output-btn"),i=document.getElementById("download-output-btn"),l=document.getElementById("paste-input-btn"),u=document.getElementById("clear-input-btn"),s=document.getElementById("clear-file-btn"),m=document.getElementById("input-char-count"),f=document.getElementById("input-byte-count"),p=document.getElementById("output-char-count"),h=document.getElementById("output-byte-count"),v=document.getElementById("alert-container");let b="base64",g=null,y="";function E(){o.value="",g=null,y="",t.placeholder=M("encoder.input_placeholder")||"Enter text to encode/decode..."}function w(e){try{let o;o="encode"===e?function(){if(g){if("url"===b)throw new Error("URL encoding only supports text input, not files");const e=new Uint8Array(g);return"base64"===b?B(e):L(e)}{const e=t.value.trim();if(!e)throw new Error("Please enter text or select a file to encode");if("url"===b)return encodeURIComponent(e);const n=(new TextEncoder).encode(e);return"base64"===b?B(n):L(n)}}():function(){const e=t.value.trim();if(!e)throw new Error("Please enter text to decode");if("url"===b)try{return decodeURIComponent(e)}catch(e){throw new Error("Invalid URL-encoded string")}let n;n="base64"===b?function(e){try{const t=atob(e),n=t.length,o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=t.charCodeAt(e);return o}catch(e){throw new Error("Invalid Base64 string")}}(e):function(e){if(e=e.replace(/\s/g,""),!/^[0-9A-Fa-f]*$/.test(e))throw new Error("Invalid hexadecimal string");if(e.length%2!=0)throw new Error("Hexadecimal string must have even length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substr(n,2),16);return t}(e);try{return new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch{return L(n)}}(),null!==o&&(n.value=o,x(),a.disabled=!1,i.disabled=!1,C(`Successfully ${e}d!`,"success"))}catch(e){C(`Error: ${e.message}`,"danger"),n.value="",x()}}function B(e){let t="";const n=e.byteLength;for(let o=0;o<n;o++)t+=String.fromCharCode(e[o]);return btoa(t)}function L(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}function I(){const e=t.value;m.textContent=e.length,f.textContent=new Blob([e]).size}function x(){const e=n.value;p.textContent=e.length,h.textContent=new Blob([e]).size}function C(e,t){const n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show`,n.innerHTML=`\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,v.innerHTML="",v.appendChild(n),setTimeout(()=>{n.remove()},5e3)}function M(e){return void 0!==window.translations&&window.translations[e]?window.translations[e]:null}I(),e.forEach(e=>{e.addEventListener("change",function(){b=this.value})}),t.addEventListener("input",function(){I(),g=null,o.value=""}),n.addEventListener("input",function(){x()}),o.addEventListener("change",function(e){const n=e.target.files[0];if(!n)return;if(n.size>10485760)return C("File size exceeds 10MB limit","danger"),void(o.value="");y=n.name;const r=new FileReader;r.onload=function(e){g=e.target.result,t.value="",t.placeholder=`File loaded: ${y} (${function(e){if(0===e)return"0 Bytes";const t=1024,n=["Bytes","KB","MB"],o=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,o)*100)/100+" "+n[o]}(n.size)})`,I()},r.readAsArrayBuffer(n)}),s.addEventListener("click",E),r.addEventListener("click",()=>w("encode")),c.addEventListener("click",()=>w("decode")),d.addEventListener("click",function(){const e=t.value;t.value=n.value,n.value=e,E(),I(),x(),n.value?(a.disabled=!1,i.disabled=!1):(a.disabled=!0,i.disabled=!0)}),a.addEventListener("click",async function(){try{await navigator.clipboard.writeText(n.value),C("Copied to clipboard!","success");const e=a.innerHTML;a.innerHTML='<i class="fas fa-check"></i> '+(M("encoder.copied")||"Copied!"),setTimeout(()=>{a.innerHTML=e},2e3)}catch(e){C("Failed to copy to clipboard","danger")}}),i.addEventListener("click",function(){const e=n.value;if(!e)return;const t=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o;const c="base64"===b?"base64.txt":"hex.txt";r.download=y?`${y}.${c}`:`output.${c}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),C("File downloaded!","success")}),l.addEventListener("click",async function(){try{const e=await navigator.clipboard.readText();t.value=e,E(),I(),C("Pasted from clipboard!","success")}catch(e){C("Failed to read clipboard","danger")}}),u.addEventListener("click",function(){t.value="",E(),I()})});