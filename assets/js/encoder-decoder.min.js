document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll('input[name="format"]'),t=document.getElementById("input-text"),n=document.getElementById("output-text"),o=document.getElementById("file-input"),r=document.getElementById("encode-btn"),c=document.getElementById("decode-btn"),a=document.getElementById("swap-btn"),d=document.getElementById("copy-output-btn"),i=document.getElementById("download-output-btn"),l=document.getElementById("paste-input-btn"),u=document.getElementById("clear-input-btn"),s=document.getElementById("clear-file-btn"),m=document.getElementById("input-char-count"),f=document.getElementById("input-byte-count"),p=document.getElementById("output-char-count"),h=document.getElementById("output-byte-count"),b=document.getElementById("alert-container");let v="base64",g=null,E="";function y(){o.value="",g=null,E="",t.placeholder=M("encoder.input_placeholder")||"Enter text to encode/decode..."}function w(e){try{let o;o="encode"===e?function(){if(g){if("url"===v)throw new Error("URL encoding only supports text input, not files");const e=new Uint8Array(g);return"base64"===v?B(e):L(e)}{const e=t.value.trim();if(!e)throw new Error("Please enter text or select a file to encode");if("url"===v)return encodeURIComponent(e);const n=(new TextEncoder).encode(e);return"base64"===v?B(n):L(n)}}():function(){const e=t.value.trim();if(!e)throw new Error("Please enter text to decode");if("url"===v)try{return decodeURIComponent(e)}catch(e){throw new Error("Invalid URL-encoded string")}let n;n="base64"===v?function(e){try{const t=atob(e),n=t.length,o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=t.charCodeAt(e);return o}catch(e){throw new Error("Invalid Base64 string")}}(e):function(e){if(e=e.replace(/\s/g,""),!/^[0-9A-Fa-f]*$/.test(e))throw new Error("Invalid hexadecimal string");if(e.length%2!=0)throw new Error("Hexadecimal string must have even length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substr(n,2),16);return t}(e);try{return new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch{return L(n)}}(),null!==o&&(n.value=o,I(),d.disabled=!1,i.disabled=!1,C(`Successfully ${e}d!`,"success"))}catch(e){C(`Error: ${e.message}`,"danger"),n.value="",I()}}function B(e){let t="";const n=e.byteLength;for(let o=0;o<n;o++)t+=String.fromCharCode(e[o]);return btoa(t)}function L(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}function x(){const e=t.value;m.textContent=e.length,f.textContent=new Blob([e]).size}function I(){const e=n.value;p.textContent=e.length,h.textContent=new Blob([e]).size}function C(e,t){const n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show`;const o=document.createElement("span");o.textContent=e;const r=document.createElement("button");r.type="button",r.className="btn-close",r.setAttribute("data-bs-dismiss","alert"),r.setAttribute("aria-label","Close"),n.appendChild(o),n.appendChild(r),b.innerHTML="",b.appendChild(n),setTimeout(()=>{n.remove()},5e3)}function M(e){return void 0!==window.translations&&window.translations[e]?window.translations[e]:null}x(),e.forEach(e=>{e.addEventListener("change",function(){v=this.value})}),t.addEventListener("input",function(){x(),g=null,o.value=""}),n.addEventListener("input",function(){I()}),o.addEventListener("change",function(e){const n=e.target.files[0];if(!n)return;if(n.size>10485760)return C("File size exceeds 10MB limit","danger"),void(o.value="");E=n.name;const r=new FileReader;r.onload=function(e){g=e.target.result,t.value="",t.placeholder=`File loaded: ${E} (${function(e){if(0===e)return"0 Bytes";const t=1024,n=["Bytes","KB","MB"],o=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,o)*100)/100+" "+n[o]}(n.size)})`,x()},r.readAsArrayBuffer(n)}),s.addEventListener("click",y),r.addEventListener("click",()=>w("encode")),c.addEventListener("click",()=>w("decode")),a.addEventListener("click",function(){const e=t.value;t.value=n.value,n.value=e,y(),x(),I(),n.value?(d.disabled=!1,i.disabled=!1):(d.disabled=!0,i.disabled=!0)}),d.addEventListener("click",async function(){try{await navigator.clipboard.writeText(n.value),C("Copied to clipboard!","success");const e=d.innerHTML;d.innerHTML='<i class="fas fa-check"></i> '+(M("encoder.copied")||"Copied!"),setTimeout(()=>{d.innerHTML=e},2e3)}catch(e){C("Failed to copy to clipboard","danger")}}),i.addEventListener("click",function(){const e=n.value;if(!e)return;const t=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o;const c="base64"===v?"base64.txt":"hex.txt";r.download=E?`${E}.${c}`:`output.${c}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),C("File downloaded!","success")}),l.addEventListener("click",async function(){try{const e=await navigator.clipboard.readText();t.value=e,y(),x(),C("Pasted from clipboard!","success")}catch(e){C("Failed to read clipboard","danger")}}),u.addEventListener("click",function(){t.value="",y(),x()})});