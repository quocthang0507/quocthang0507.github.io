document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("color-preview"),t=document.getElementById("hex-input"),n={r:document.getElementById("rgb-r"),g:document.getElementById("rgb-g"),b:document.getElementById("rgb-b")},a={h:document.getElementById("hsl-h"),s:document.getElementById("hsl-s"),l:document.getElementById("hsl-l")},o={h:document.getElementById("hsv-h"),s:document.getElementById("hsv-s"),v:document.getElementById("hsv-v")},s={c:document.getElementById("cmyk-c"),m:document.getElementById("cmyk-m"),y:document.getElementById("cmyk-y"),k:document.getElementById("cmyk-k")},c=document.getElementById("color-wheel"),r=c.getContext("2d"),l=document.getElementById("harmony-select"),F=document.getElementById("harmony-colors"),d=document.getElementById("random-color-btn"),i=document.getElementById("add-to-palette-btn"),h=document.getElementById("clear-palette-btn"),u=document.getElementById("saved-colors"),m=document.getElementById("alert-container"),v=document.getElementById("css-hex"),E=document.getElementById("css-rgb"),B=document.getElementById("css-hsl"),g=document.getElementById("brightness-value"),C=document.getElementById("luminance-value"),p=document.getElementById("preset-palette-display");let D={r:255,g:87,b:51},f=JSON.parse(localStorage.getItem("colorPalette")||"[]"),y=!1;const b={pastel:["FFB3BA","FFDFBA","FFFFBA","BAFFC9","BAE1FF","E8BAFF"],vintage:["8B4513","A0522D","CD853F","DEB887","F5DEB3","2F4F4F"],retro:["FF6B6B","FFE66D","4ECDC4","45B7D1","96CEB4","FFEAA7"],neon:["FF00FF","00FFFF","00FF00","FFFF00","FF0080","8000FF"],gold:["FFD700","FFC125","FFB90F","DAA520","B8860B","8B6914"],light:["FFFFFF","F8F9FA","E9ECEF","DEE2E6","CED4DA","ADB5BD"],dark:["212529","343A40","495057","6C757D","868E96","ADB5BD"],warm:["FF6B6B","FF8E72","FFA07A","FFB347","FFCC5C","FFE66D"],cold:["4A90D9","5DADE2","76D7EA","7FDBFF","A8E6CF","B8D4E3"],summer:["FF6B6B","FFA07A","FFD93D","6BCB77","4D96FF","F72585"],fall:["D35400","E67E22","F39C12","FFC300","8B4513","654321"],winter:["1E3A5F","3D5A80","98C1D9","E0FBFC","FFFFFF","293241"],spring:["98D8AA","C9F4AA","FCFFB2","FFD4D4","F0B3B3","E7A0C4"],happy:["FFD93D","FF6B6B","6BCB77","4D96FF","C9B1FF","FF8FAB"],nature:["228B22","32CD32","90EE90","8FBC8F","2E8B57","006400"],earth:["8B4513","A0522D","D2691E","DEB887","8B8B00","556B2F"],night:["0D1B2A","1B263B","415A77","778DA9","E0E1DD","000814"],space:["0B0C10","1F2833","45A29E","66FCF1","C5C6C7","5C2D91"],rainbow:["FF0000","FF7F00","FFFF00","00FF00","0000FF","8B00FF"],gradient:["667EEA","764BA2","F093FB","F5576C","FED6E3","4FACFE"],sunset:["FF512F","F09819","DD2476","FF512F","FDC830","F37335"],sky:["87CEEB","00BFFF","1E90FF","4169E1","6495ED","B0E0E6"],sea:["006994","0077B6","0096C7","00B4D8","48CAE4","90E0EF"],kids:["FF6B6B","FFD93D","6BCB77","4D96FF","C9B1FF","FF8FAB"],skin:["FFE5D9","D4A574","C68642","8D5524","6B4423","4A312C"],food:["FF6347","FFD700","32CD32","FF69B4","8B4513","FFA500"],cream:["FFFDD0","FFF8DC","FAEBD7","FFE4C4","FFDAB9","FFE4E1"],coffee:["3C2415","5C4033","6F4E37","8B7355","A0826D","D2B48C"],wedding:["FFFFFF","FFFAF0","FFF0F5","FFE4E1","D4AF37","C0C0C0"],christmas:["C41E3A","165B33","FFD700","FFFFFF","BB0A21","146B3A"],halloween:["FF6600","000000","800080","008000","FFD700","DC143C"]};function M(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1).toUpperCase()}function A(e){3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map(e=>e+e).join(""));const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function I(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n),s=a-o;let c,r=0===a?0:s/a;const l=a;if(a===o)c=0;else switch(a){case e:c=((t-n)/s+(t<n?6:0))/6;break;case t:c=((n-e)/s+2)/6;break;case n:c=((e-t)/s+4)/6}return{h:Math.round(360*c),s:Math.round(100*r),v:Math.round(100*l)}}function k(e,t,n){let a,o,s;e/=360,t/=100,n/=100;const c=Math.floor(6*e),r=6*e-c,l=n*(1-t),F=n*(1-r*t),d=n*(1-(1-r)*t);switch(c%6){case 0:a=n,o=d,s=l;break;case 1:a=F,o=n,s=l;break;case 2:a=l,o=n,s=d;break;case 3:a=l,o=F,s=n;break;case 4:a=d,o=l,s=n;break;case 5:a=n,o=l,s=F}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*s)}}function L(){y||(y=!0,D={r:parseInt(n.r.value)||0,g:parseInt(n.g.value)||0,b:parseInt(n.b.value)||0},$(),y=!1)}function $(){const{r:c,g:r,b:l}=D,F=M(c,r,l);t.value=F,n.r.value=c,n.g.value=r,n.b.value=l;const d=function(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n);let s,c,r=(a+o)/2;if(a===o)s=c=0;else{const l=a-o;switch(c=r>.5?l/(2-a-o):l/(a+o),a){case e:s=((t-n)/l+(t<n?6:0))/6;break;case t:s=((n-e)/l+2)/6;break;case n:s=((e-t)/l+4)/6}}return{h:Math.round(360*s),s:Math.round(100*c),l:Math.round(100*r)}}(c,r,l);a.h.value=d.h,a.s.value=d.s,a.l.value=d.l;const i=I(c,r,l);o.h.value=i.h,o.s.value=i.s,o.v.value=i.v;const h=function(e,t,n){e/=255,t/=255,n/=255;const a=1-Math.max(e,t,n),o=1===a?0:(1-e-a)/(1-a),s=1===a?0:(1-t-a)/(1-a),c=1===a?0:(1-n-a)/(1-a);return{c:Math.round(100*o),m:Math.round(100*s),y:Math.round(100*c),k:Math.round(100*a)}}(c,r,l);s.c.value=h.c,s.m.value=h.m,s.y.value=h.y,s.k.value=h.k;const u=`rgb(${c}, ${r}, ${l})`;e.style.backgroundColor=u,v.textContent=`#${F}`,E.textContent=`rgb(${c}, ${r}, ${l})`,B.textContent=`hsl(${d.h}, ${d.s}%, ${d.l}%)`;const m=Math.round((299*c+587*r+114*l)/1e3),p=(.299*c+.587*r+.114*l)/255;g.textContent=`${m} / 255 (${Math.round(100*p)}%)`,C.textContent=p.toFixed(3),x(),w()}function x(){const e=c.width/2,t=c.height/2,n=Math.min(e,t)-10;r.clearRect(0,0,c.width,c.height);for(let a=0;a<360;a++){const o=(a-90)*Math.PI/180,s=(a+1-90)*Math.PI/180,c=r.createRadialGradient(e,t,0,e,t,n),l=`hsl(${a}, 100%, 50%)`;c.addColorStop(0,"white"),c.addColorStop(1,l),r.beginPath(),r.moveTo(e,t),r.arc(e,t,n,o,s),r.closePath(),r.fillStyle=c,r.fill()}const a=I(D.r,D.g,D.b),o=(a.h-90)*Math.PI/180,s=a.s/100*n,l=e+s*Math.cos(o),F=t+s*Math.sin(o);r.beginPath(),r.arc(l,F,8,0,2*Math.PI),r.fillStyle="white",r.fill(),r.strokeStyle="black",r.lineWidth=2,r.stroke()}function w(){const e=l.value;if(F.innerHTML="","none"===e)return;const t=I(D.r,D.g,D.b);let n=[];switch(e){case"complementary":n=[t,{h:(t.h+180)%360,s:t.s,v:t.v}];break;case"analogous":n=[{h:(t.h-30+360)%360,s:t.s,v:t.v},t,{h:(t.h+30)%360,s:t.s,v:t.v}];break;case"triadic":n=[t,{h:(t.h+120)%360,s:t.s,v:t.v},{h:(t.h+240)%360,s:t.s,v:t.v}];break;case"split-complementary":n=[t,{h:(t.h+150)%360,s:t.s,v:t.v},{h:(t.h+210)%360,s:t.s,v:t.v}];break;case"square":n=[t,{h:(t.h+90)%360,s:t.s,v:t.v},{h:(t.h+180)%360,s:t.s,v:t.v},{h:(t.h+270)%360,s:t.s,v:t.v}];break;case"tetradic":n=[t,{h:(t.h+60)%360,s:t.s,v:t.v},{h:(t.h+180)%360,s:t.s,v:t.v},{h:(t.h+240)%360,s:t.s,v:t.v}];break;case"monochromatic":n=[{h:t.h,s:t.s,v:Math.max(20,t.v-40)},{h:t.h,s:t.s,v:Math.max(40,t.v-20)},t,{h:t.h,s:Math.max(0,t.s-30),v:Math.min(100,t.v+10)},{h:t.h,s:Math.max(0,t.s-50),v:Math.min(100,t.v+20)}];break;case"shades":n=[{h:t.h,s:t.s,v:20},{h:t.h,s:t.s,v:40},{h:t.h,s:t.s,v:60},{h:t.h,s:t.s,v:80},{h:t.h,s:t.s,v:100}]}n.forEach(e=>{const t=k(e.h,e.s,e.v),n=M(t.r,t.g,t.b),a=document.createElement("div");a.className="harmony-color",a.style.backgroundColor=`#${n}`,a.title=`#${n}`,a.addEventListener("click",()=>{D=t,$()});const o=document.createElement("div");o.className="harmony-color-label",o.textContent=`#${n}`,a.appendChild(o),F.appendChild(a)})}function S(){0!==f.length?(u.innerHTML="",f.forEach((e,t)=>{const n=document.createElement("div");n.className="saved-color",n.style.backgroundColor=`#${e}`,n.title=`#${e}`,n.addEventListener("click",()=>{D=A(e),$()});const a=document.createElement("div");a.className="delete-btn",a.innerHTML="Ã—",a.addEventListener("click",e=>{e.stopPropagation(),f.splice(t,1),localStorage.setItem("colorPalette",JSON.stringify(f)),S()}),n.appendChild(a),u.appendChild(n)})):u.innerHTML='<div class="text-muted small" data-i18n="color.no_saved">No saved colors yet.</div>'}function P(e,t){const n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show`,n.innerHTML=`\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,m.innerHTML="",m.appendChild(n),setTimeout(()=>{n.remove()},3e3)}x(),L(),S(),t.addEventListener("input",()=>function(){if(y)return;y=!0;const e=t.value.replace(/^#/,"");/^[0-9A-Fa-f]{6}$/.test(e)&&(D=A(e),$());y=!1}()),Object.values(n).forEach(e=>e.addEventListener("input",()=>L())),Object.values(a).forEach(e=>e.addEventListener("input",()=>function(){if(y)return;y=!0;const e=parseInt(a.h.value)||0,t=parseInt(a.s.value)||0,n=parseInt(a.l.value)||0;D=function(e,t,n){let a,o,s;if(e/=360,t/=100,n/=100,0===t)a=o=s=n;else{const c=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),r=n<.5?n*(1+t):n+t-n*t,l=2*n-r;a=c(l,r,e+1/3),o=c(l,r,e),s=c(l,r,e-1/3)}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*s)}}(e,t,n),$(),y=!1}())),Object.values(o).forEach(e=>e.addEventListener("input",()=>function(){if(y)return;y=!0;const e=parseInt(o.h.value)||0,t=parseInt(o.s.value)||0,n=parseInt(o.v.value)||0;D=k(e,t,n),$(),y=!1}())),Object.values(s).forEach(e=>e.addEventListener("input",()=>function(){if(y)return;y=!0;const e=parseInt(s.c.value)||0,t=parseInt(s.m.value)||0,n=parseInt(s.y.value)||0,a=parseInt(s.k.value)||0;D=function(e,t,n,a){e/=100,t/=100,n/=100,a/=100;const o=255*(1-e)*(1-a),s=255*(1-t)*(1-a),c=255*(1-n)*(1-a);return{r:Math.round(o),g:Math.round(s),b:Math.round(c)}}(e,t,n,a),$(),y=!1}())),c.addEventListener("click",function(e){const t=c.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,o=c.width/2,s=c.height/2,r=Math.min(o,s)-10,l=n-o,F=a-s,d=Math.sqrt(l*l+F*F);if(d<=r){let e=180*Math.atan2(F,l)/Math.PI+90;e<0&&(e+=360);const t=Math.min(100,d/r*100);D=k(e,t,100),$()}}),l.addEventListener("change",w),d.addEventListener("click",function(){D={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},$()}),i.addEventListener("click",function(){const e=M(D.r,D.g,D.b);f.includes(e)?P("Color already in palette","info"):(f.push(e),localStorage.setItem("colorPalette",JSON.stringify(f)),S(),P("Color added to palette!","success"))}),h.addEventListener("click",function(){confirm("Are you sure you want to clear all saved colors?")&&(f=[],localStorage.setItem("colorPalette",JSON.stringify(f)),S(),P("Palette cleared","success"))}),e.addEventListener("click",()=>t.focus()),document.querySelectorAll(".preset-palette-btn").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".preset-palette-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active");!function(e){if(!p||!b[e])return;p.innerHTML="",b[e].forEach(e=>{const t=document.createElement("div");t.className="preset-color",t.style.backgroundColor=`#${e}`,t.title=`#${e}`,t.addEventListener("click",()=>{D=A(e),$()});const n=document.createElement("div");n.className="preset-color-label",n.textContent=`#${e}`,t.appendChild(n),p.appendChild(t)})}(this.getAttribute("data-palette"))})}),document.querySelectorAll(".copy-btn").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-target"),t=document.getElementById(e);!async function(e,t){try{await navigator.clipboard.writeText(e);const n=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{t.innerHTML=n},1500)}catch(e){P("Failed to copy","danger")}}("hex-input"===e?"#"+t.value:t.value,this)})})});