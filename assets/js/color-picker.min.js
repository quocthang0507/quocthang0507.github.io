document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("color-preview"),t=document.getElementById("hex-input"),n={r:document.getElementById("rgb-r"),g:document.getElementById("rgb-g"),b:document.getElementById("rgb-b")},a={h:document.getElementById("hsl-h"),s:document.getElementById("hsl-s"),l:document.getElementById("hsl-l")},o={h:document.getElementById("hsv-h"),s:document.getElementById("hsv-s"),v:document.getElementById("hsv-v")},r={c:document.getElementById("cmyk-c"),m:document.getElementById("cmyk-m"),y:document.getElementById("cmyk-y"),k:document.getElementById("cmyk-k")},c=document.getElementById("color-wheel"),s=c.getContext("2d"),l=document.getElementById("harmony-select"),d=document.getElementById("harmony-colors"),i=document.getElementById("random-color-btn"),u=document.getElementById("add-to-palette-btn"),m=document.getElementById("clear-palette-btn"),F=document.getElementById("saved-colors"),h=document.getElementById("alert-container"),v=document.getElementById("css-hex"),E=document.getElementById("css-rgb"),g=document.getElementById("css-hsl"),p=document.getElementById("brightness-value"),B=document.getElementById("luminance-value"),f=document.getElementById("preset-palette-display"),y=document.getElementById("contrast-text-color"),C=document.getElementById("contrast-text-hex"),b=document.getElementById("contrast-bg-color"),M=document.getElementById("contrast-bg-hex"),I=document.getElementById("contrast-preview"),D=document.getElementById("contrast-ratio"),A=document.getElementById("contrast-aa-normal"),k=document.getElementById("contrast-aaa-normal"),L=document.getElementById("contrast-aa-large"),x=document.getElementById("contrast-aaa-large"),$=document.getElementById("gradient-angle"),w=document.getElementById("gradient-angle-number"),S=document.getElementById("gradient-stops"),N=document.getElementById("gradient-add-stop"),T=document.getElementById("gradient-preview"),P=document.getElementById("gradient-css"),H=document.getElementById("gradient-copy");let O={r:255,g:87,b:51},_=JSON.parse(localStorage.getItem("colorPalette")||"[]"),j=!1;function q(e,t){try{if(window.translationSystem&&"function"==typeof window.translationSystem.t)return window.translationSystem.t(e,t??e)}catch(e){}return t??e}let J=[{color:"#667EEA",pos:0},{color:"#764BA2",pos:100}];const R={pastel:["FFB3BA","FFDFBA","FFFFBA","BAFFC9","BAE1FF","E8BAFF"],vintage:["8B4513","A0522D","CD853F","DEB887","F5DEB3","2F4F4F"],retro:["FF6B6B","FFE66D","4ECDC4","45B7D1","96CEB4","FFEAA7"],neon:["FF00FF","00FFFF","00FF00","FFFF00","FF0080","8000FF"],gold:["FFD700","FFC125","FFB90F","DAA520","B8860B","8B6914"],light:["FFFFFF","F8F9FA","E9ECEF","DEE2E6","CED4DA","ADB5BD"],dark:["212529","343A40","495057","6C757D","868E96","ADB5BD"],warm:["FF6B6B","FF8E72","FFA07A","FFB347","FFCC5C","FFE66D"],cold:["4A90D9","5DADE2","76D7EA","7FDBFF","A8E6CF","B8D4E3"],summer:["FF6B6B","FFA07A","FFD93D","6BCB77","4D96FF","F72585"],fall:["D35400","E67E22","F39C12","FFC300","8B4513","654321"],winter:["1E3A5F","3D5A80","98C1D9","E0FBFC","FFFFFF","293241"],spring:["98D8AA","C9F4AA","FCFFB2","FFD4D4","F0B3B3","E7A0C4"],happy:["FFD93D","FF6B6B","6BCB77","4D96FF","C9B1FF","FF8FAB"],nature:["228B22","32CD32","90EE90","8FBC8F","2E8B57","006400"],earth:["8B4513","A0522D","D2691E","DEB887","8B8B00","556B2F"],night:["0D1B2A","1B263B","415A77","778DA9","E0E1DD","000814"],space:["0B0C10","1F2833","45A29E","66FCF1","C5C6C7","5C2D91"],rainbow:["FF0000","FF7F00","FFFF00","00FF00","0000FF","8B00FF"],gradient:["667EEA","764BA2","F093FB","F5576C","FED6E3","4FACFE"],sunset:["FF512F","F09819","DD2476","FF512F","FDC830","F37335"],sky:["87CEEB","00BFFF","1E90FF","4169E1","6495ED","B0E0E6"],sea:["006994","0077B6","0096C7","00B4D8","48CAE4","90E0EF"],kids:["FF6B6B","FFD93D","6BCB77","4D96FF","C9B1FF","FF8FAB"],skin:["FFE5D9","D4A574","C68642","8D5524","6B4423","4A312C"],food:["FF6347","FFD700","32CD32","FF69B4","8B4513","FFA500"],cream:["FFFDD0","FFF8DC","FAEBD7","FFE4C4","FFDAB9","FFE4E1"],coffee:["3C2415","5C4033","6F4E37","8B7355","A0826D","D2B48C"],wedding:["FFFFFF","FFFAF0","FFF0F5","FFE4E1","D4AF37","C0C0C0"],christmas:["C41E3A","165B33","FFD700","FFFFFF","BB0A21","146B3A"],halloween:["FF6600","000000","800080","008000","FFD700","DC143C"]};function U(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1).toUpperCase()}function G(e){3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map(e=>e+e).join(""));const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function W(e){if(!e)return null;let t=String(e).trim();if(!t)return null;"#"!==t[0]&&(t="#"+t);const n=/^#([0-9A-Fa-f]{3})$/.exec(t);if(n){return"#"+n[1].split("").map(e=>e+e).join("").toUpperCase()}const a=/^#([0-9A-Fa-f]{6})$/.exec(t);return a?"#"+a[1].toUpperCase():null}function X(e){const t=W(e);if(!t)return null;const n=G(t);return{r:n.r,g:n.g,b:n.b}}function Y(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function z(e){return.2126*Y(e.r)+.7152*Y(e.g)+.0722*Y(e.b)}function K(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n),r=a-o;let c,s=0===a?0:r/a;const l=a;if(a===o)c=0;else switch(a){case e:c=((t-n)/r+(t<n?6:0))/6;break;case t:c=((n-e)/r+2)/6;break;case n:c=((e-t)/r+4)/6}return{h:Math.round(360*c),s:Math.round(100*s),v:Math.round(100*l)}}function Q(e,t,n){let a,o,r;e/=360,t/=100,n/=100;const c=Math.floor(6*e),s=6*e-c,l=n*(1-t),d=n*(1-s*t),i=n*(1-(1-s)*t);switch(c%6){case 0:a=n,o=i,r=l;break;case 1:a=d,o=n,r=l;break;case 2:a=l,o=n,r=i;break;case 3:a=l,o=d,r=n;break;case 4:a=i,o=l,r=n;break;case 5:a=n,o=l,r=d}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*r)}}function V(){j||(j=!0,O={r:parseInt(n.r.value)||0,g:parseInt(n.g.value)||0,b:parseInt(n.b.value)||0},Z(),j=!1)}function Z(){const{r:c,g:s,b:l}=O,d=U(c,s,l);t.value=d,n.r.value=c,n.g.value=s,n.b.value=l;const i=function(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n);let r,c,s=(a+o)/2;if(a===o)r=c=0;else{const l=a-o;switch(c=s>.5?l/(2-a-o):l/(a+o),a){case e:r=((t-n)/l+(t<n?6:0))/6;break;case t:r=((n-e)/l+2)/6;break;case n:r=((e-t)/l+4)/6}}return{h:Math.round(360*r),s:Math.round(100*c),l:Math.round(100*s)}}(c,s,l);a.h.value=i.h,a.s.value=i.s,a.l.value=i.l;const u=K(c,s,l);o.h.value=u.h,o.s.value=u.s,o.v.value=u.v;const m=function(e,t,n){e/=255,t/=255,n/=255;const a=1-Math.max(e,t,n),o=1===a?0:(1-e-a)/(1-a),r=1===a?0:(1-t-a)/(1-a),c=1===a?0:(1-n-a)/(1-a);return{c:Math.round(100*o),m:Math.round(100*r),y:Math.round(100*c),k:Math.round(100*a)}}(c,s,l);r.c.value=m.c,r.m.value=m.m,r.y.value=m.y,r.k.value=m.k;const F=`rgb(${c}, ${s}, ${l})`;e.style.backgroundColor=F,v.textContent=`#${d}`,E.textContent=`rgb(${c}, ${s}, ${l})`,g.textContent=`hsl(${i.h}, ${i.s}%, ${i.l}%)`;const h=Math.round((299*c+587*s+114*l)/1e3),f=(.299*c+.587*s+.114*l)/255;p.textContent=`${h} / 255 (${Math.round(100*f)}%)`,B.textContent=f.toFixed(3),oe(),re()}function ee(e,t){e&&(e.classList.remove("bg-secondary","bg-success","bg-danger"),e.classList.add(t?"bg-success":"bg-danger"))}function te(){if(!I)return;const e=X(C?C.value:y.value),t=X(M?M.value:b.value);if(!e||!t)return void(D&&(D.textContent="-"));const n=function(e,t){const n=z(e),a=z(t);return(Math.max(n,a)+.05)/(Math.min(n,a)+.05)}(e,t);D&&(D.textContent=n.toFixed(2)+":1"),I.style.backgroundColor=W(b.value)||"#ffffff",I.style.color=W(y.value)||"#111111";const a=n>=7,o=n>=3,r=n>=4.5;ee(A,n>=4.5),ee(k,a),ee(L,o),ee(x,r)}function ne(){S&&(S.innerHTML="",J.map((e,t)=>({...e,idx:t})).forEach(e=>{const t=document.createElement("div");t.className="gradient-stop-row";const n=document.createElement("input");n.type="color",n.className="form-control form-control-color",n.value=W(e.color)||"#000000",n.title="Stop color";const a=document.createElement("input");a.type="text",a.className="form-control font-monospace",a.value=W(e.color)||"#000000",a.placeholder="#000000";const o=document.createElement("input");o.type="number",o.className="form-control",o.min="0",o.max="100",o.value=String(Math.max(0,Math.min(100,parseInt(e.pos,10)||0)));const r=document.createElement("button");r.type="button",r.className="btn btn-outline-danger",r.innerHTML='<i class="fas fa-trash"></i>',r.disabled=J.length<=2;const c=()=>{const t=W(a.value)||W(n.value);t&&(a.value=t,n.value=t);const r=Math.max(0,Math.min(100,parseInt(o.value,10)||0));J[e.idx]={color:t||"#000000",pos:r},ae()};n.addEventListener("input",()=>{a.value=W(n.value)||"#000000",c()}),a.addEventListener("input",c),o.addEventListener("input",c),r.addEventListener("click",()=>{J.length<=2||(J.splice(e.idx,1),ne())}),t.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(r),S.appendChild(t)}),ae())}function ae(){if(!P||!T)return;const e=`background: linear-gradient(${Math.max(0,Math.min(360,parseInt($.value,10)||0))}deg, ${[...J].map(e=>({color:W(e.color)||"#000000",pos:Math.max(0,Math.min(100,parseInt(e.pos,10)||0))})).sort((e,t)=>e.pos-t.pos).map(e=>`${e.color} ${e.pos}%`).join(", ")});`;P.value=e;const t=e.match(/linear-gradient\((.*)\);$/),n=t?`linear-gradient(${t[1]})`:"linear-gradient(90deg, #000000 0%, #ffffff 100%)";T.style.backgroundImage=n}function oe(){const e=c.width/2,t=c.height/2,n=Math.min(e,t)-10;s.clearRect(0,0,c.width,c.height);for(let a=0;a<360;a++){const o=(a-90)*Math.PI/180,r=(a+1-90)*Math.PI/180,c=s.createRadialGradient(e,t,0,e,t,n),l=`hsl(${a}, 100%, 50%)`;c.addColorStop(0,"white"),c.addColorStop(1,l),s.beginPath(),s.moveTo(e,t),s.arc(e,t,n,o,r),s.closePath(),s.fillStyle=c,s.fill()}const a=K(O.r,O.g,O.b),o=(a.h-90)*Math.PI/180,r=a.s/100*n,l=e+r*Math.cos(o),d=t+r*Math.sin(o);s.beginPath(),s.arc(l,d,8,0,2*Math.PI),s.fillStyle="white",s.fill(),s.strokeStyle="black",s.lineWidth=2,s.stroke()}function re(){const e=l.value;if(d.innerHTML="","none"===e)return;const t=K(O.r,O.g,O.b);let n=[];switch(e){case"complementary":n=[t,{h:(t.h+180)%360,s:t.s,v:t.v}];break;case"analogous":n=[{h:(t.h-30+360)%360,s:t.s,v:t.v},t,{h:(t.h+30)%360,s:t.s,v:t.v}];break;case"triadic":n=[t,{h:(t.h+120)%360,s:t.s,v:t.v},{h:(t.h+240)%360,s:t.s,v:t.v}];break;case"split-complementary":n=[t,{h:(t.h+150)%360,s:t.s,v:t.v},{h:(t.h+210)%360,s:t.s,v:t.v}];break;case"square":n=[t,{h:(t.h+90)%360,s:t.s,v:t.v},{h:(t.h+180)%360,s:t.s,v:t.v},{h:(t.h+270)%360,s:t.s,v:t.v}];break;case"tetradic":n=[t,{h:(t.h+60)%360,s:t.s,v:t.v},{h:(t.h+180)%360,s:t.s,v:t.v},{h:(t.h+240)%360,s:t.s,v:t.v}];break;case"monochromatic":n=[{h:t.h,s:t.s,v:Math.max(20,t.v-40)},{h:t.h,s:t.s,v:Math.max(40,t.v-20)},t,{h:t.h,s:Math.max(0,t.s-30),v:Math.min(100,t.v+10)},{h:t.h,s:Math.max(0,t.s-50),v:Math.min(100,t.v+20)}];break;case"shades":n=[{h:t.h,s:t.s,v:20},{h:t.h,s:t.s,v:40},{h:t.h,s:t.s,v:60},{h:t.h,s:t.s,v:80},{h:t.h,s:t.s,v:100}]}n.forEach(e=>{const t=Q(e.h,e.s,e.v),n=U(t.r,t.g,t.b),a=document.createElement("div");a.className="harmony-color",a.style.backgroundColor=`#${n}`,a.title=`#${n}`,a.addEventListener("click",()=>{O=t,Z()});const o=document.createElement("div");o.className="harmony-color-label",o.textContent=`#${n}`,a.appendChild(o),d.appendChild(a)})}function ce(){if(0===_.length){const e=q("color.no_saved",'No saved colors yet. Click "Add to Palette" to save colors.');return void(F.innerHTML=`<div class="text-muted small">${e}</div>`)}F.innerHTML="",_.forEach((e,t)=>{const n=document.createElement("div");n.className="saved-color",n.style.backgroundColor=`#${e}`,n.title=`#${e}`,n.addEventListener("click",()=>{O=G(e),Z()});const a=document.createElement("div");a.className="delete-btn",a.innerHTML="Ã—",a.addEventListener("click",e=>{e.stopPropagation(),_.splice(t,1),localStorage.setItem("colorPalette",JSON.stringify(_)),ce()}),n.appendChild(a),F.appendChild(n)})}async function se(e,t){try{await navigator.clipboard.writeText(e);const n=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{t.innerHTML=n},1500)}catch(e){le(q("common.copy_error",q("color.copy_failed","Failed to copy")),"danger")}}function le(e,t){const n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show`,n.innerHTML=`\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,h.innerHTML="",h.appendChild(n),setTimeout(()=>{n.remove()},3e3)}oe(),V(),ce(),function(){if(!y||!b||!I)return;const e=(e,t)=>{const n=W(e.value);n&&(t.value=n)},t=(e,t)=>{const n=W(e.value);n&&(e.value=n,t.value=n)};y.addEventListener("input",()=>{e(y,C),te()}),b.addEventListener("input",()=>{e(b,M),te()}),C.addEventListener("input",()=>{t(C,y),te()}),M.addEventListener("input",()=>{t(M,b),te()}),t(C,y),t(M,b),te()}(),function(){if(!($&&S&&T&&P))return;const e=e=>{const t=Math.max(0,Math.min(360,parseInt(e,10)||0));$.value=String(t),w.value=String(t),ne()};$.addEventListener("input",()=>e($.value)),w.addEventListener("input",()=>e(w.value)),N&&N.addEventListener("click",()=>{if(J.length>=5)return;const e=2===J.length?50:Math.round(J.length/4*100);J.push({color:"#F093FB",pos:e}),ne()});H&&H.addEventListener("click",()=>{se(P.value,H)});ne()}(),window.addEventListener("languageChanged",()=>{ce()}),t.addEventListener("input",()=>function(){if(j)return;j=!0;const e=t.value.replace(/^#/,"");/^[0-9A-Fa-f]{6}$/.test(e)&&(O=G(e),Z());j=!1}()),Object.values(n).forEach(e=>e.addEventListener("input",()=>V())),Object.values(a).forEach(e=>e.addEventListener("input",()=>function(){if(j)return;j=!0;const e=parseInt(a.h.value)||0,t=parseInt(a.s.value)||0,n=parseInt(a.l.value)||0;O=function(e,t,n){let a,o,r;if(e/=360,t/=100,n/=100,0===t)a=o=r=n;else{const c=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),s=n<.5?n*(1+t):n+t-n*t,l=2*n-s;a=c(l,s,e+1/3),o=c(l,s,e),r=c(l,s,e-1/3)}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*r)}}(e,t,n),Z(),j=!1}())),Object.values(o).forEach(e=>e.addEventListener("input",()=>function(){if(j)return;j=!0;const e=parseInt(o.h.value)||0,t=parseInt(o.s.value)||0,n=parseInt(o.v.value)||0;O=Q(e,t,n),Z(),j=!1}())),Object.values(r).forEach(e=>e.addEventListener("input",()=>function(){if(j)return;j=!0;const e=parseInt(r.c.value)||0,t=parseInt(r.m.value)||0,n=parseInt(r.y.value)||0,a=parseInt(r.k.value)||0;O=function(e,t,n,a){e/=100,t/=100,n/=100,a/=100;const o=255*(1-e)*(1-a),r=255*(1-t)*(1-a),c=255*(1-n)*(1-a);return{r:Math.round(o),g:Math.round(r),b:Math.round(c)}}(e,t,n,a),Z(),j=!1}())),c.addEventListener("click",function(e){const t=c.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,o=c.width/2,r=c.height/2,s=Math.min(o,r)-10,l=n-o,d=a-r,i=Math.sqrt(l*l+d*d);if(i<=s){let e=180*Math.atan2(d,l)/Math.PI+90;e<0&&(e+=360);const t=Math.min(100,i/s*100);O=Q(e,t,100),Z()}}),l.addEventListener("change",re),i.addEventListener("click",function(){O={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},Z()}),u.addEventListener("click",function(){const e=U(O.r,O.g,O.b);_.includes(e)?le(q("color.alert_exists","Color already in palette"),"info"):(_.push(e),localStorage.setItem("colorPalette",JSON.stringify(_)),ce(),le(q("color.alert_added","Color added to palette!"),"success"))}),m.addEventListener("click",function(){confirm(q("color.confirm_clear_palette","Are you sure you want to clear all saved colors?"))&&(_=[],localStorage.setItem("colorPalette",JSON.stringify(_)),ce(),le(q("color.alert_palette_cleared","Palette cleared"),"success"))}),e.addEventListener("click",()=>t.focus()),document.querySelectorAll(".preset-palette-btn").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".preset-palette-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active");!function(e){if(!f||!R[e])return;f.innerHTML="",R[e].forEach(e=>{const t=document.createElement("div");t.className="preset-color",t.style.backgroundColor=`#${e}`,t.title=`#${e}`,t.addEventListener("click",()=>{O=G(e),Z()});const n=document.createElement("div");n.className="preset-color-label",n.textContent=`#${e}`,t.appendChild(n),f.appendChild(t)})}(this.getAttribute("data-palette"))})}),document.querySelectorAll(".copy-btn").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-target"),t=document.getElementById(e);se("hex-input"===e?"#"+t.value:t.value,this)})})});