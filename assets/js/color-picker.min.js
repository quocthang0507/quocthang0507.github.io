document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("color-preview"),t=document.getElementById("hex-input"),n={r:document.getElementById("rgb-r"),g:document.getElementById("rgb-g"),b:document.getElementById("rgb-b")},a={h:document.getElementById("hsl-h"),s:document.getElementById("hsl-s"),l:document.getElementById("hsl-l")},o={h:document.getElementById("hsv-h"),s:document.getElementById("hsv-s"),v:document.getElementById("hsv-v")},s={c:document.getElementById("cmyk-c"),m:document.getElementById("cmyk-m"),y:document.getElementById("cmyk-y"),k:document.getElementById("cmyk-k")},c=document.getElementById("color-wheel"),r=c.getContext("2d"),l=document.getElementById("harmony-select"),d=document.getElementById("harmony-colors"),h=document.getElementById("random-color-btn"),i=document.getElementById("add-to-palette-btn"),u=document.getElementById("clear-palette-btn"),m=document.getElementById("saved-colors"),v=document.getElementById("alert-container"),g=document.getElementById("css-hex"),y=document.getElementById("css-rgb"),b=document.getElementById("css-hsl"),f=document.getElementById("brightness-value"),M=document.getElementById("luminance-value");let p={r:255,g:87,b:51},E=JSON.parse(localStorage.getItem("colorPalette")||"[]"),I=!1;function k(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1).toUpperCase()}function B(e){3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map(e=>e+e).join(""));const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function L(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n),s=a-o;let c,r=0===a?0:s/a;const l=a;if(a===o)c=0;else switch(a){case e:c=((t-n)/s+(t<n?6:0))/6;break;case t:c=((n-e)/s+2)/6;break;case n:c=((e-t)/s+4)/6}return{h:Math.round(360*c),s:Math.round(100*r),v:Math.round(100*l)}}function C(e,t,n){let a,o,s;e/=360,t/=100,n/=100;const c=Math.floor(6*e),r=6*e-c,l=n*(1-t),d=n*(1-r*t),h=n*(1-(1-r)*t);switch(c%6){case 0:a=n,o=h,s=l;break;case 1:a=d,o=n,s=l;break;case 2:a=l,o=n,s=h;break;case 3:a=l,o=d,s=n;break;case 4:a=h,o=l,s=n;break;case 5:a=n,o=l,s=d}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*s)}}function $(){I||(I=!0,p={r:parseInt(n.r.value)||0,g:parseInt(n.g.value)||0,b:parseInt(n.b.value)||0},x(),I=!1)}function x(){const{r:c,g:r,b:l}=p,d=k(c,r,l);t.value=d,n.r.value=c,n.g.value=r,n.b.value=l;const h=function(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n);let s,c,r=(a+o)/2;if(a===o)s=c=0;else{const l=a-o;switch(c=r>.5?l/(2-a-o):l/(a+o),a){case e:s=((t-n)/l+(t<n?6:0))/6;break;case t:s=((n-e)/l+2)/6;break;case n:s=((e-t)/l+4)/6}}return{h:Math.round(360*s),s:Math.round(100*c),l:Math.round(100*r)}}(c,r,l);a.h.value=h.h,a.s.value=h.s,a.l.value=h.l;const i=L(c,r,l);o.h.value=i.h,o.s.value=i.s,o.v.value=i.v;const u=function(e,t,n){e/=255,t/=255,n/=255;const a=1-Math.max(e,t,n),o=1===a?0:(1-e-a)/(1-a),s=1===a?0:(1-t-a)/(1-a),c=1===a?0:(1-n-a)/(1-a);return{c:Math.round(100*o),m:Math.round(100*s),y:Math.round(100*c),k:Math.round(100*a)}}(c,r,l);s.c.value=u.c,s.m.value=u.m,s.y.value=u.y,s.k.value=u.k;const m=`rgb(${c}, ${r}, ${l})`;e.style.backgroundColor=m,g.textContent=`#${d}`,y.textContent=`rgb(${c}, ${r}, ${l})`,b.textContent=`hsl(${h.h}, ${h.s}%, ${h.l}%)`;const v=Math.round((299*c+587*r+114*l)/1e3),E=(.299*c+.587*r+.114*l)/255;f.textContent=`${v} / 255 (${Math.round(100*E)}%)`,M.textContent=E.toFixed(3),w(),S()}function w(){const e=c.width/2,t=c.height/2,n=Math.min(e,t)-10;r.clearRect(0,0,c.width,c.height);for(let a=0;a<360;a++){const o=(a-90)*Math.PI/180,s=(a+1-90)*Math.PI/180,c=r.createRadialGradient(e,t,0,e,t,n),l=`hsl(${a}, 100%, 50%)`;c.addColorStop(0,"white"),c.addColorStop(1,l),r.beginPath(),r.moveTo(e,t),r.arc(e,t,n,o,s),r.closePath(),r.fillStyle=c,r.fill()}const a=L(p.r,p.g,p.b),o=(a.h-90)*Math.PI/180,s=a.s/100*n,l=e+s*Math.cos(o),d=t+s*Math.sin(o);r.beginPath(),r.arc(l,d,8,0,2*Math.PI),r.fillStyle="white",r.fill(),r.strokeStyle="black",r.lineWidth=2,r.stroke()}function S(){const e=l.value;if(d.innerHTML="","none"===e)return;const t=L(p.r,p.g,p.b);let n=[];switch(e){case"complementary":n=[t,{h:(t.h+180)%360,s:t.s,v:t.v}];break;case"analogous":n=[{h:(t.h-30+360)%360,s:t.s,v:t.v},t,{h:(t.h+30)%360,s:t.s,v:t.v}];break;case"triadic":n=[t,{h:(t.h+120)%360,s:t.s,v:t.v},{h:(t.h+240)%360,s:t.s,v:t.v}];break;case"split-complementary":n=[t,{h:(t.h+150)%360,s:t.s,v:t.v},{h:(t.h+210)%360,s:t.s,v:t.v}];break;case"square":n=[t,{h:(t.h+90)%360,s:t.s,v:t.v},{h:(t.h+180)%360,s:t.s,v:t.v},{h:(t.h+270)%360,s:t.s,v:t.v}];break;case"tetradic":n=[t,{h:(t.h+60)%360,s:t.s,v:t.v},{h:(t.h+180)%360,s:t.s,v:t.v},{h:(t.h+240)%360,s:t.s,v:t.v}];break;case"monochromatic":n=[{h:t.h,s:t.s,v:Math.max(20,t.v-40)},{h:t.h,s:t.s,v:Math.max(40,t.v-20)},t,{h:t.h,s:Math.max(0,t.s-30),v:Math.min(100,t.v+10)},{h:t.h,s:Math.max(0,t.s-50),v:Math.min(100,t.v+20)}];break;case"shades":n=[{h:t.h,s:t.s,v:20},{h:t.h,s:t.s,v:40},{h:t.h,s:t.s,v:60},{h:t.h,s:t.s,v:80},{h:t.h,s:t.s,v:100}]}n.forEach(e=>{const t=C(e.h,e.s,e.v),n=k(t.r,t.g,t.b),a=document.createElement("div");a.className="harmony-color",a.style.backgroundColor=`#${n}`,a.title=`#${n}`,a.addEventListener("click",()=>{p=t,x()});const o=document.createElement("div");o.className="harmony-color-label",o.textContent=`#${n}`,a.appendChild(o),d.appendChild(a)})}function P(){0!==E.length?(m.innerHTML="",E.forEach((e,t)=>{const n=document.createElement("div");n.className="saved-color",n.style.backgroundColor=`#${e}`,n.title=`#${e}`,n.addEventListener("click",()=>{p=B(e),x()});const a=document.createElement("div");a.className="delete-btn",a.innerHTML="Ã—",a.addEventListener("click",e=>{e.stopPropagation(),E.splice(t,1),localStorage.setItem("colorPalette",JSON.stringify(E)),P()}),n.appendChild(a),m.appendChild(n)})):m.innerHTML='<div class="text-muted small" data-i18n="color.no_saved">No saved colors yet.</div>'}function T(e,t){const n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show`,n.innerHTML=`\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,v.innerHTML="",v.appendChild(n),setTimeout(()=>{n.remove()},3e3)}w(),$(),P(),t.addEventListener("input",()=>function(){if(I)return;I=!0;const e=t.value.replace(/^#/,"");/^[0-9A-Fa-f]{6}$/.test(e)&&(p=B(e),x());I=!1}()),Object.values(n).forEach(e=>e.addEventListener("input",()=>$())),Object.values(a).forEach(e=>e.addEventListener("input",()=>function(){if(I)return;I=!0;const e=parseInt(a.h.value)||0,t=parseInt(a.s.value)||0,n=parseInt(a.l.value)||0;p=function(e,t,n){let a,o,s;if(e/=360,t/=100,n/=100,0===t)a=o=s=n;else{const c=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),r=n<.5?n*(1+t):n+t-n*t,l=2*n-r;a=c(l,r,e+1/3),o=c(l,r,e),s=c(l,r,e-1/3)}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*s)}}(e,t,n),x(),I=!1}())),Object.values(o).forEach(e=>e.addEventListener("input",()=>function(){if(I)return;I=!0;const e=parseInt(o.h.value)||0,t=parseInt(o.s.value)||0,n=parseInt(o.v.value)||0;p=C(e,t,n),x(),I=!1}())),Object.values(s).forEach(e=>e.addEventListener("input",()=>function(){if(I)return;I=!0;const e=parseInt(s.c.value)||0,t=parseInt(s.m.value)||0,n=parseInt(s.y.value)||0,a=parseInt(s.k.value)||0;p=function(e,t,n,a){e/=100,t/=100,n/=100,a/=100;const o=255*(1-e)*(1-a),s=255*(1-t)*(1-a),c=255*(1-n)*(1-a);return{r:Math.round(o),g:Math.round(s),b:Math.round(c)}}(e,t,n,a),x(),I=!1}())),c.addEventListener("click",function(e){const t=c.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,o=c.width/2,s=c.height/2,r=Math.min(o,s)-10,l=n-o,d=a-s,h=Math.sqrt(l*l+d*d);if(h<=r){let e=180*Math.atan2(d,l)/Math.PI+90;e<0&&(e+=360);const t=Math.min(100,h/r*100);p=C(e,t,100),x()}}),l.addEventListener("change",S),h.addEventListener("click",function(){p={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},x()}),i.addEventListener("click",function(){const e=k(p.r,p.g,p.b);E.includes(e)?T("Color already in palette","info"):(E.push(e),localStorage.setItem("colorPalette",JSON.stringify(E)),P(),T("Color added to palette!","success"))}),u.addEventListener("click",function(){confirm("Are you sure you want to clear all saved colors?")&&(E=[],localStorage.setItem("colorPalette",JSON.stringify(E)),P(),T("Palette cleared","success"))}),e.addEventListener("click",()=>t.focus()),document.querySelectorAll(".copy-btn").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-target"),t=document.getElementById(e);!async function(e,t){try{await navigator.clipboard.writeText(e);const n=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{t.innerHTML=n},1500)}catch(e){T("Failed to copy","danger")}}("hex-input"===e?"#"+t.value:t.value,this)})})});