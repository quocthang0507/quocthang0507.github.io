document.addEventListener("DOMContentLoaded",function(){let e=loadFromLocalStorage("wheelNames")||[],t=loadFromLocalStorage("wheelSpinHistory")||[],n=!1,o=0,a=localStorage.getItem("wheelColorTheme")||"classic";const s={colors:["ƒê·ªè","Xanh l√°","Xanh d∆∞∆°ng","V√†ng","T√≠m","Cam","H·ªìng","N√¢u"],animals:["Ch√≥","M√®o","Voi","S∆∞ t·ª≠","H·ªï","G·∫•u","Th·ªè","C√°o"],fruits:["T√°o","Chu·ªëi","Cam","Nho","D√¢u","D·ª©a","Xo√†i","L√™"],numbers:["1","2","3","4","5","6","7","8","9","10"]},l={classic:{name:"Classic",colors:["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#34495e","#f1c40f","#e91e63","#673ab7","#00bcd4","#4caf50","#ff5722","#795548","#607d8b"]},vibrant:{name:"Vibrant",colors:["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2","#F8B739","#52B788","#F48FB1","#4DB8FF","#FFD93D","#6BCF7F","#A78BFA","#FB8B24"]},pastel:{name:"Pastel",colors:["#FFB3BA","#BAFFC9","#BAE1FF","#FFFFBA","#E0BBE4","#FFDFD3","#D4F1F4","#FFE5B4","#C7CEEA","#FFC8DD","#CCD5AE","#E0AFA0","#B4E7CE","#F6BD60","#E5B8F4","#A8DADC"]},neon:{name:"Neon",colors:["#FF10F0","#39FF14","#FFFF00","#FF3F00","#00F0FF","#BC13FE","#FF073A","#7FFF00","#FE4EDA","#4D4DFF","#FFB900","#FE019A","#39FF14","#FF6EC7","#08F7FE","#DEFE47"]},ocean:{name:"Ocean",colors:["#006994","#1E88A8","#3FA7D6","#59C3F0","#7AD8F5","#89CFF0","#4FA3CC","#2E8BC0","#0077B6","#00B4D8","#90E0EF","#48CAE4","#00A3C4","#0096C7","#0288D1","#029ACA"]},sunset:{name:"Sunset",colors:["#FF6B35","#F7931E","#FDC830","#F37335","#FFA07A","#FF7F50","#FF8C42","#FF6F61","#FF5E5B","#D64545","#FA8072","#E9573F","#FF6B6B","#EE6352","#FF9A76","#FFA384"]},forest:{name:"Forest",colors:["#2D5016","#406343","#4A7C59","#56A36C","#6BB77B","#7EC488","#90D399","#A7DBA9","#50723C","#73A24E","#8FBC66","#A8D08D","#C7E9C0","#87B87F","#6DA76A","#4F9153"]},candy:{name:"Candy",colors:["#FF1493","#FF69B4","#FFB6C1","#FFC0CB","#FF85C1","#FF6B9D","#FF1493","#C71585","#DA70D6","#EE82EE","#DDA0DD","#D8BFD8","#FF77FF","#F754E1","#FF00FF","#FF69EB"]},autumn:{name:"Autumn",colors:["#8B4513","#A0522D","#D2691E","#CD853F","#DEB887","#F4A460","#D2B48C","#BC8F8F","#B8860B","#DAA520","#CD5C5C","#A0522D","#8B7355","#C19A6B","#B87333","#966919"]},monochrome:{name:"Monochrome",colors:["#1A1A1A","#333333","#4D4D4D","#666666","#808080","#999999","#B3B3B3","#CCCCCC","#2B2B2B","#404040","#595959","#737373","#8C8C8C","#A6A6A6","#BFBFBF","#D9D9D9"]},rainbow:{name:"Rainbow",colors:["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3","#FF1493","#FF4500","#FFD700","#7FFF00","#00FFFF","#1E90FF","#8A2BE2","#FF69B4","#DC143C"]},earth:{name:"Earth",colors:["#8B7355","#A0826D","#C19A6B","#D2B48C","#8B4513","#A0522D","#B87333","#CD853F","#7B6043","#93785B","#AB8F76","#C4A88F","#6B5344","#86705D","#9D8777","#B39D8F"]}};let c,i,r,d;function m(){if(c||function(){try{c=new(window.AudioContext||window.webkitAudioContext),i=c.createGain(),i.connect(c.destination)}catch(e){console.log("Web Audio API not supported")}}(),c){const e=document.getElementById("wheel-spin-audio");e&&e.canPlayType&&""!==e.canPlayType("audio/mpeg")?(e.currentTime=0,e.play().catch(()=>{u()})):u()}}function u(){if(!c)return;if(r)try{r.stop(),r.disconnect()}catch(e){}r=c.createOscillator();const e=c.createGain();r.connect(e),e.connect(i),r.frequency.setValueAtTime(200,c.currentTime),r.frequency.exponentialRampToValueAtTime(100,c.currentTime+3),e.gain.setValueAtTime(.1,c.currentTime),e.gain.exponentialRampToValueAtTime(.01,c.currentTime+3),r.type="sawtooth",r.start(c.currentTime),r.stop(c.currentTime+3)}function h(){return l[a]?.colors||l.classic.colors}function F(t){""!==(t=t.trim())?t.length>20?showAlert("T√™n kh√¥ng ƒë∆∞·ª£c d√†i qu√° 20 k√Ω t·ª±!","warning"):e.includes(t)?showAlert("T√™n n√†y ƒë√£ t·ªìn t·∫°i!","warning"):e.length>=16?showAlert("Ch·ªâ c√≥ th·ªÉ th√™m t·ªëi ƒëa 16 t√™n!","warning"):(e.push(t),f(),B(),y(),E(),document.getElementById("name-input").value=""):showAlert("Vui l√≤ng nh·∫≠p t√™n!","warning")}function g(t){e.splice(t,1),f(),B(),y(),E()}function f(){saveToLocalStorage("wheelNames",e)}function B(){const t=document.getElementById("names-list");if(0===e.length)return t.innerHTML='<p class="text-muted text-center">Ch∆∞a c√≥ t√™n n√†o</p>',void(document.getElementById("spin-btn").disabled=!0);document.getElementById("spin-btn").disabled=!1;const n=h();t.innerHTML=e.map((e,t)=>`\n            <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">\n                <span class="name-item" style="color: ${n[t%n.length]}">\n                    <i class="fas fa-circle"></i> ${e}\n                </span>\n                <button class="btn btn-outline-danger btn-sm remove-name-btn" data-index="${t}">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        `).join(""),document.querySelectorAll(".remove-name-btn").forEach(e=>{e.addEventListener("click",function(){g(parseInt(this.dataset.index))})})}function y(){const t=document.getElementById("wheel-names");if(0===e.length)return void(t.innerHTML="");let n=t.querySelector("canvas");n||(n=document.createElement("canvas"),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",t.innerHTML="",t.appendChild(n));const o=window.devicePixelRatio||1,a=n.getBoundingClientRect(),s=Math.max(1,Math.floor(Math.min(a.width,a.height)||400));n.width=Math.round(s*o),n.height=Math.round(s*o);const l=n.getContext("2d");l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,n.width,n.height),l.setTransform(o,0,0,o,0,0);const c=s/2,i=s/2,r=s/2,d=2*Math.PI/e.length,m=h();e.forEach((t,n)=>{const o=n*d-Math.PI/2,a=(n+1)*d-Math.PI/2,s=m[n%m.length];l.beginPath(),l.moveTo(c,i),l.arc(c,i,r,o,a),l.closePath(),l.fillStyle=s,l.fill(),l.strokeStyle="rgba(255, 255, 255, 0.5)",l.lineWidth=2,l.stroke(),l.save();const u=o+d/2,h=.65*r,F=c+h*Math.cos(u),g=i+h*Math.sin(u);l.translate(F,g),l.rotate(u+Math.PI/2);let f=16;e.length>12?f=12:e.length>8&&(f=14),t.length>12?f=Math.max(10,f-2):t.length>8&&(f=Math.max(12,f-1)),l.font=`bold ${f}px 'Segoe UI', Arial, sans-serif`,l.fillStyle="white",l.textAlign="center",l.textBaseline="middle",l.shadowColor="rgba(0, 0, 0, 0.8)",l.shadowBlur=3,l.shadowOffsetX=0,l.shadowOffsetY=1,l.fillText(t,0,0),l.restore()})}function p(){const e=document.getElementById("spin-history");e&&(0!==t.length?(e.innerHTML=t.map((e,t)=>`\n            <div class="d-flex justify-content-between align-items-center mb-2 p-2 border-start border-4 border-primary bg-light rounded">\n                <div>\n                    <strong>${e.winner}</strong>\n                    <small class="text-muted d-block">${e.timestamp}</small>\n                    <small class="text-muted">T·ª´ ${e.totalNames} t√™n</small>\n                </div>\n                <button class="btn btn-outline-danger btn-sm delete-history-item-btn" data-index="${t}">\n                    <i class="fas fa-trash"></i>\n                </button>\n            </div>\n        `).join(""),document.querySelectorAll(".delete-history-item-btn").forEach(e=>{e.addEventListener("click",function(){const e=parseInt(this.dataset.index);t.splice(e,1),saveToLocalStorage("wheelSpinHistory",t),p(),E()})})):e.innerHTML='<p class="text-muted text-center">Ch∆∞a c√≥ l·ªãch s·ª≠</p>')}function E(){const n=document.getElementById("total-spins"),o=document.getElementById("current-names-count"),a=document.getElementById("top-winners");if(n&&(n.textContent=t.length),o&&(o.textContent=e.length),a)if(t.length>0){const e={};t.forEach(t=>{e[t.winner]=(e[t.winner]||0)+1});const n=Object.entries(e).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>`<div class="d-flex justify-content-between">\n                    <span>${e}</span>\n                    <span class="badge bg-primary">${t}</span>\n                </div>`).join("");a.innerHTML=n}else a.innerHTML='<p class="text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu</p>'}!function(){const e=document.getElementById("color-theme-selector");e&&(e.innerHTML=Object.entries(l).map(([e,t])=>`<option value="${e}" ${e===a?"selected":""}>${t.name}</option>`).join(""),e.addEventListener("change",function(){!function(e){if(l[e]){a=e,localStorage.setItem("wheelColorTheme",e),B(),y();const t=document.getElementById("color-theme-selector");t&&(t.value=e),"undefined"!=typeof gtag&&gtag("event","color_theme_change",{event_category:"random_wheel_customization",event_label:e})}}(this.value)}))}(),B(),y(),p(),E(),document.getElementById("add-name-btn").addEventListener("click",function(){F(document.getElementById("name-input").value)}),document.getElementById("name-input").addEventListener("keypress",function(e){"Enter"===e.key&&F(this.value)}),document.getElementById("add-bulk-btn").addEventListener("click",function(){const t=document.getElementById("bulk-names").value.split("\n").filter(e=>""!==e.trim());let n=0;t.forEach(t=>{(t=t.trim())&&!e.includes(t)&&e.length<16&&(e.push(t),n++)}),n>0&&(f(),B(),y(),E(),document.getElementById("bulk-names").value="",showAlert(`ƒê√£ th√™m ${n} t√™n!`,"success"))}),document.getElementById("spin-btn").addEventListener("click",function(){if(n||0===e.length)return;n=!0,document.getElementById("spin-btn").disabled=!0,document.getElementById("spin-btn").innerHTML='<i class="fas fa-spinner fa-spin"></i> ƒêang quay...',"undefined"!=typeof gtag&&gtag("event","wheel_spin_start",{event_category:"random_wheel_tools",event_label:"wheel_interaction",total_options:e.length}),m();const a=3*Math.random()+3,s=360*Math.random();o+=360*a+s,document.getElementById("wheel-names").style.transform=`rotate(${o}deg)`,setTimeout(()=>{!function(){const e=document.getElementById("wheel-spin-audio");if(e&&(e.pause(),e.currentTime=0),r)try{r.stop(),r.disconnect(),r=null}catch(e){r=null}}();const a=(360-o%360)%360,s=360/e.length,l=Math.floor(a/s),c=e[l];"undefined"!=typeof gtag&&gtag("event","wheel_spin_complete",{event_category:"random_wheel_tools",event_label:"wheel_result",winner_index:l,total_options:e.length}),function(n,o){const a=document.getElementById("wheel-result");a&&(a.textContent=n);const s={winner:n,timestamp:(new Date).toLocaleString("vi-VN"),totalNames:e.length};t.unshift(s),t.length>50&&(t=t.slice(0,50));saveToLocalStorage("wheelSpinHistory",t),p(),E();const l=document.getElementById("confetti-effect");l&&l.checked&&function(){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999";for(let t=0;t<30;t++){const t=document.createElement("div");t.innerHTML=["üéâ","üéä","‚≠ê","‚ú®","üåü"][Math.floor(5*Math.random())],t.style.position="absolute",t.style.left=100*Math.random()+"%",t.style.fontSize=20*Math.random()+20+"px",t.style.animation=`confetti-fall ${2*Math.random()+2}s linear forwards`,e.appendChild(t)}if(document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},4e3),!document.getElementById("confetti-style")){const e=document.createElement("style");e.id="confetti-style",e.textContent="\n                @keyframes confetti-fall {\n                    0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }\n                    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }\n                }\n            ",document.head.appendChild(e)}}();const c=document.getElementById("remove-winner");c&&c.checked&&setTimeout(()=>{confirm(`X√≥a "${n}" kh·ªèi danh s√°ch?`)&&g(o)},1e3);showAlert(`üéâ Ng∆∞·ªùi th·∫Øng: ${n}!`,"success")}(c,l),n=!1,document.getElementById("spin-btn").disabled=!1,document.getElementById("spin-btn").innerHTML='<i class="fas fa-play"></i> Quay b√°nh xe'},3e3)}),document.getElementById("reset-wheel-btn").addEventListener("click",function(){const e=document.getElementById("wheel-names");o=0,e.style.transform="rotate(0deg)",document.getElementById("wheel-result").textContent='Th√™m t√™n v√† nh·∫•n "Quay b√°nh xe"'}),window.addEventListener("resize",function(){clearTimeout(d),d=setTimeout(()=>{n||y()},150)}),document.getElementById("clear-names-btn").addEventListener("click",function(){e.length>0&&confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ t√™n?")&&(e=[],f(),B(),y(),E(),showAlert("ƒê√£ x√≥a t·∫•t c·∫£ t√™n!","success"))}),document.getElementById("clear-history-wheel-btn").addEventListener("click",function(){t.length>0&&confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch s·ª≠?")&&(t=[],saveToLocalStorage("wheelSpinHistory",t),p(),E(),showAlert("ƒê√£ x√≥a l·ªãch s·ª≠!","success"))}),document.getElementById("export-wheel-data-btn").addEventListener("click",function(){const n={names:e,history:t,exportDate:(new Date).toISOString()},o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n,null,2)),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download",`wheel-data-${(new Date).toISOString().split("T")[0]}.json`),document.body.appendChild(a),a.click(),document.body.removeChild(a),showAlert("ƒê√£ xu·∫•t d·ªØ li·ªáu th√†nh c√¥ng!","success")}),document.querySelectorAll(".preset-names-btn").forEach(t=>{t.addEventListener("click",function(){const t=this.dataset.preset;s[t]&&(e=[...s[t]],f(),B(),y(),E(),showAlert(`ƒê√£ t·∫£i preset: ${t}!`,"success"),"undefined"!=typeof gtag&&gtag("event","wheel_preset_load",{event_category:"random_wheel_tools",event_label:t,preset_type:t,preset_size:s[t].length}))})})});