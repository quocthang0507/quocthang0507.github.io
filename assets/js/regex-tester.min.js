document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("regex-pattern"),t=document.getElementById("regex-flags"),n=document.getElementById("regex-text"),s=document.getElementById("regex-highlight"),a=document.getElementById("match-count"),u=document.getElementById("regex-error"),r=document.getElementById("regex-replacement"),l=document.getElementById("run-replace"),c=document.getElementById("regex-replace-output"),i=document.getElementById("regex-explain");function o(e){return(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function d(e){const t=new Set(["g","i","m","s","u","y"]),n=[];for(const s of e||"")t.has(s)&&!n.includes(s)&&n.push(s);return n.join("")}function g(){const n=d(t.value);t.value=n;const s=e.value||"";try{const e=new RegExp(s,n);return u.textContent="",e}catch(e){return u.textContent=e&&e.message?e.message:"Invalid regex",null}}function p(){const u=g(),r=n.value||"";if(i.innerHTML=function(e,t){const n=[];if(!e)return"";const s=t=>t.test(e);s(/\./)&&n.push("`.` matches any character (except newline unless `s` flag)"),s(/\\d/)&&n.push("`\\d` matches a digit"),s(/\\w/)&&n.push("`\\w` matches a word character"),s(/\\s/)&&n.push("`\\s` matches whitespace"),s(/\[/)&&n.push("`[...]` is a character class"),s(/\(/)&&n.push("`(...)` is a capturing group"),s(/\?:\)/)&&n.push("`(?:...)` is a non-capturing group"),s(/\*|\+|\?/)&&n.push("`* + ?` are quantifiers"),s(/\{\d+(,\d*)?\}/)&&n.push("`{m,n}` is a repetition quantifier"),s(/\^/)&&n.push("`^` anchors to start of text/line (with `m`)"),s(/\$/)&&n.push("`$` anchors to end of text/line (with `m`)"),s(/\|/)&&n.push("`|` is alternation (OR)");const a=[];t.includes("g")&&a.push("`g` global (find all)"),t.includes("i")&&a.push("`i` ignore case"),t.includes("m")&&a.push("`m` multiline"),t.includes("s")&&a.push("`s` dotAll"),t.includes("u")&&a.push("`u` unicode"),t.includes("y")&&a.push("`y` sticky");const u=[];return a.length&&u.push(`Flags: ${a.join(", ")}`),n.length&&u.push(n.join("<br>")),u.join("<br><br>")}(e.value||"",d(t.value)),!u)return a.textContent="0",void(s.innerHTML=o(r));const l=u.flags.includes("g")?u.flags:u.flags+"g";let c;try{c=new RegExp(u.source,l)}catch{c=u}const p=[];if(r.length)for(const e of r.matchAll(c))null!=e.index&&(""!==e[0]?p.push({start:e.index,end:e.index+e[0].length,value:e[0]}):(p.push({start:e.index,end:e.index,value:""}),c.lastIndex===e.index&&c.lastIndex++));a.textContent=String(p.filter(e=>e.end>e.start).length);let h="",m=0;for(const e of p)e.end<=e.start||(h+=o(r.slice(m,e.start)),h+=`<mark>${o(r.slice(e.start,e.end))}</mark>`,m=e.end);h+=o(r.slice(m)),s.innerHTML=h}function h(){const e=g();if(!e)return void(c.value="");const t=n.value||"",s=r.value??"";try{c.value=t.replace(e,s),"function"==typeof trackToolUsage&&trackToolUsage("regex_tester","replace")}catch(e){c.value="","function"==typeof showAlert&&showAlert(e&&e.message?e.message:"Replace error","danger")}}e.addEventListener("input",p),t.addEventListener("input",p),n.addEventListener("input",p),l.addEventListener("click",h),r.addEventListener("input",()=>{c.value&&h()}),e.value||(e.value="\\b\\w+\\b"),t.value||(t.value="g"),n.value||(n.value="Hello API v2: regex_test-123"),p(),h()});