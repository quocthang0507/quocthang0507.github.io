function calculateDateDifference(){const e=document.getElementById("diffFromDate").value,t=document.getElementById("diffToDate").value;if(!e||!t)return void alert(window.i18n?.translate("date_calc.error.select_dates")||"Please select both dates");const a=new Date(e),n=new Date(t),l=Math.abs(n-a),o=Math.floor(l/6e4),d=Math.floor(l/36e5),c=Math.floor(l/864e5),r=Math.floor(c/7);let u=n.getFullYear()-a.getFullYear(),s=n.getMonth()-a.getMonth(),g=n.getDate()-a.getDate();if(g<0){s--;g+=new Date(n.getFullYear(),n.getMonth(),0).getDate()}s<0&&(u--,s+=12),a>n&&(u=-u,s=-s,g=-g),document.getElementById("diffYears").textContent=u,document.getElementById("diffMonths").textContent=s,document.getElementById("diffDays").textContent=g,document.getElementById("diffWeeks").textContent=r.toLocaleString(),document.getElementById("diffHours").textContent=d.toLocaleString(),document.getElementById("diffMinutes").textContent=o.toLocaleString();const i=`${c.toLocaleString()} ${window.i18n?.translate("date_calc.days")||"days"} (${r.toLocaleString()} ${window.i18n?.translate("date_calc.weeks")||"weeks"})`;document.getElementById("diffTotal").textContent=i,document.getElementById("diffResult").style.display="block"}function addToDate(){const e=document.getElementById("addStartDate").value;if(!e)return void alert(window.i18n?.translate("date_calc.error.select_date")||"Please select a date");const t=new Date(e),a=parseInt(document.getElementById("addYears").value)||0,n=parseInt(document.getElementById("addMonths").value)||0,l=parseInt(document.getElementById("addDays").value)||0,o=parseInt(document.getElementById("addWeeks").value)||0,d=new Date(t);d.setFullYear(d.getFullYear()+a),d.setMonth(d.getMonth()+n),d.setDate(d.getDate()+l+7*o),displayAddResult(d,t,"+")}function subtractFromDate(){const e=document.getElementById("addStartDate").value;if(!e)return void alert(window.i18n?.translate("date_calc.error.select_date")||"Please select a date");const t=new Date(e),a=parseInt(document.getElementById("addYears").value)||0,n=parseInt(document.getElementById("addMonths").value)||0,l=parseInt(document.getElementById("addDays").value)||0,o=parseInt(document.getElementById("addWeeks").value)||0,d=new Date(t);d.setFullYear(d.getFullYear()-a),d.setMonth(d.getMonth()-n),d.setDate(d.getDate()-l-7*o),displayAddResult(d,t,"-")}function displayAddResult(e,t,a){const n=localStorage.getItem("language")||"vi";document.getElementById("addResultDate").textContent=e.toLocaleDateString(n,{weekday:"long",year:"numeric",month:"long",day:"numeric"});const l=Math.floor(Math.abs(e-t)/864e5),o="+"===a?`${l} ${window.i18n?.translate("date_calc.days_after")||"days after"}`:`${l} ${window.i18n?.translate("date_calc.days_before")||"days before"}`;document.getElementById("addResultInfo").textContent=o,document.getElementById("addResult").style.display="block"}function calculateAge(){const e=document.getElementById("birthDate").value;if(!e)return void alert(window.i18n?.translate("date_calc.error.select_birth_date")||"Please select your birth date");const t=new Date(e),a=new Date;if(t>a)return void alert(window.i18n?.translate("date_calc.error.future_date")||"Birth date cannot be in the future");let n=a.getFullYear()-t.getFullYear(),l=a.getMonth()-t.getMonth(),o=a.getDate()-t.getDate();if(o<0){l--;o+=new Date(a.getFullYear(),a.getMonth(),0).getDate()}l<0&&(n--,l+=12);const d=12*n+l,c=a-t,r=Math.floor(c/864e5),u=Math.floor(r/7);document.getElementById("ageYears").textContent=n,document.getElementById("ageMonths").textContent=l,document.getElementById("ageDays").textContent=o,document.getElementById("ageTotalMonths").textContent=d.toLocaleString(),document.getElementById("ageTotalWeeks").textContent=u.toLocaleString(),document.getElementById("ageTotalDays").textContent=r.toLocaleString();const s=new Date(a.getFullYear(),t.getMonth(),t.getDate());s<a&&s.setFullYear(a.getFullYear()+1);const g=Math.floor((s-a)/864e5),i=localStorage.getItem("language")||"vi",m=`${s.toLocaleDateString(i,{weekday:"long",year:"numeric",month:"long",day:"numeric"})} (${g} ${window.i18n?.translate("date_calc.days_left")||"days left"})`;document.getElementById("nextBirthday").textContent=m,document.getElementById("ageResult").style.display="block"}function calculateWeekday(){const e=document.getElementById("weekdayDate").value;if(!e)return void alert(window.i18n?.translate("date_calc.error.select_date")||"Please select a date");const t=new Date(e),a=localStorage.getItem("language")||"vi",n=t.toLocaleDateString(a,{weekday:"long"}),l=t.toLocaleDateString(a,{weekday:"long",year:"numeric",month:"long",day:"numeric"});document.getElementById("weekdayName").textContent=n;const o=getDayOfYear(t),d=getWeekNumber(t),c=`\n        <strong>${l}</strong><br>\n        ${window.i18n?.translate("date_calc.day_of_year")||"Day of year"}: ${o}<br>\n        ${window.i18n?.translate("date_calc.week_of_year")||"Week of year"}: ${d}\n    `;document.getElementById("weekdayInfo").innerHTML=c,document.getElementById("weekdayResult").style.display="block"}function getDayOfYear(e){const t=new Date(e.getFullYear(),0,0),a=e-t;return Math.floor(a/864e5)}function getWeekNumber(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),a=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-a);const n=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-n)/864e5+1)/7)}document.addEventListener("DOMContentLoaded",function(){const e=(new Date).toISOString().split("T")[0];document.getElementById("diffFromDate").value=e,document.getElementById("diffToDate").value=e,document.getElementById("addStartDate").value=e,document.getElementById("weekdayDate").value=e}),window.i18n&&window.i18n.on("languageChanged",function(){"block"===document.getElementById("diffResult").style.display&&calculateDateDifference(),"block"===document.getElementById("ageResult").style.display&&calculateAge(),"block"===document.getElementById("weekdayResult").style.display&&calculateWeekday()});