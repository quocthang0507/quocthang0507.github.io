document.addEventListener("DOMContentLoaded",function(){let e=loadFromLocalStorage("conversionHistory")||[];const t={length:{name:"Length",base:"meter",units:{meter:{name:"Meter (m)",factor:1},kilometer:{name:"Kilometer (km)",factor:1e3},centimeter:{name:"Centimeter (cm)",factor:.01},millimeter:{name:"Millimeter (mm)",factor:.001},mile:{name:"Mile (mi)",factor:1609.344},yard:{name:"Yard (yd)",factor:.9144},foot:{name:"Foot (ft)",factor:.3048},inch:{name:"Inch (in)",factor:.0254},nautical_mile:{name:"Nautical Mile",factor:1852}}},weight:{name:"Weight",base:"kilogram",units:{kilogram:{name:"Kilogram (kg)",factor:1},gram:{name:"Gram (g)",factor:.001},milligram:{name:"Milligram (mg)",factor:1e-6},ton:{name:"Metric Ton (t)",factor:1e3},pound:{name:"Pound (lb)",factor:.453592},ounce:{name:"Ounce (oz)",factor:.0283495},stone:{name:"Stone (st)",factor:6.35029},carat:{name:"Carat",factor:2e-4}}},temperature:{name:"Temperature",base:"celsius",units:{celsius:{name:"Celsius (°C)",factor:1},fahrenheit:{name:"Fahrenheit (°F)",factor:1},kelvin:{name:"Kelvin (K)",factor:1}},convert:function(e,t,n){let o=e;return"fahrenheit"===t?o=5*(e-32)/9:"kelvin"===t&&(o=e-273.15),"fahrenheit"===n?9*o/5+32:"kelvin"===n?o+273.15:o}},volume:{name:"Volume",base:"liter",units:{liter:{name:"Liter (L)",factor:1},milliliter:{name:"Milliliter (mL)",factor:.001},cubic_meter:{name:"Cubic Meter (m³)",factor:1e3},cubic_centimeter:{name:"Cubic Centimeter (cm³)",factor:.001},gallon_us:{name:"US Gallon (gal)",factor:3.78541},gallon_uk:{name:"UK Gallon (gal)",factor:4.54609},quart:{name:"Quart (qt)",factor:.946353},pint:{name:"Pint (pt)",factor:.473176},cup:{name:"Cup",factor:.236588},fluid_ounce:{name:"Fluid Ounce (fl oz)",factor:.0295735},tablespoon:{name:"Tablespoon (tbsp)",factor:.0147868},teaspoon:{name:"Teaspoon (tsp)",factor:.00492892}}},area:{name:"Area",base:"square_meter",units:{square_meter:{name:"Square Meter (m²)",factor:1},square_kilometer:{name:"Square Kilometer (km²)",factor:1e6},square_centimeter:{name:"Square Centimeter (cm²)",factor:1e-4},hectare:{name:"Hectare (ha)",factor:1e4},acre:{name:"Acre",factor:4046.86},square_mile:{name:"Square Mile (mi²)",factor:2589988.11},square_yard:{name:"Square Yard (yd²)",factor:.836127},square_foot:{name:"Square Foot (ft²)",factor:.092903},square_inch:{name:"Square Inch (in²)",factor:64516e-8}}},speed:{name:"Speed",base:"meter_per_second",units:{meter_per_second:{name:"Meter/second (m/s)",factor:1},kilometer_per_hour:{name:"Kilometer/hour (km/h)",factor:.277778},mile_per_hour:{name:"Mile/hour (mph)",factor:.44704},foot_per_second:{name:"Foot/second (ft/s)",factor:.3048},knot:{name:"Knot (kn)",factor:.514444}}},time:{name:"Time",base:"second",units:{second:{name:"Second (s)",factor:1},millisecond:{name:"Millisecond (ms)",factor:.001},microsecond:{name:"Microsecond (μs)",factor:1e-6},minute:{name:"Minute (min)",factor:60},hour:{name:"Hour (hr)",factor:3600},day:{name:"Day",factor:86400},week:{name:"Week",factor:604800},month:{name:"Month (30 days)",factor:2592e3},year:{name:"Year (365 days)",factor:31536e3}}},data:{name:"Data Storage",base:"byte",units:{bit:{name:"Bit",factor:.125},byte:{name:"Byte (B)",factor:1},kilobyte:{name:"Kilobyte (KB)",factor:1024},megabyte:{name:"Megabyte (MB)",factor:1048576},gigabyte:{name:"Gigabyte (GB)",factor:1073741824},terabyte:{name:"Terabyte (TB)",factor:1099511627776},petabyte:{name:"Petabyte (PB)",factor:0x4000000000000}}}},n={length:[{from:"kilometer",to:"mile",fromVal:1,label:"1 km = 0.621371 mi"},{from:"meter",to:"foot",fromVal:1,label:"1 m = 3.28084 ft"},{from:"inch",to:"centimeter",fromVal:1,label:"1 in = 2.54 cm"},{from:"mile",to:"kilometer",fromVal:1,label:"1 mi = 1.60934 km"}],weight:[{from:"kilogram",to:"pound",fromVal:1,label:"1 kg = 2.20462 lb"},{from:"pound",to:"kilogram",fromVal:1,label:"1 lb = 0.453592 kg"},{from:"ton",to:"pound",fromVal:1,label:"1 t = 2204.62 lb"},{from:"ounce",to:"gram",fromVal:1,label:"1 oz = 28.3495 g"}],temperature:[{from:"celsius",to:"fahrenheit",fromVal:0,label:"0°C = 32°F"},{from:"celsius",to:"fahrenheit",fromVal:100,label:"100°C = 212°F"},{from:"celsius",to:"kelvin",fromVal:0,label:"0°C = 273.15 K"},{from:"fahrenheit",to:"celsius",fromVal:32,label:"32°F = 0°C"}],volume:[{from:"liter",to:"gallon_us",fromVal:1,label:"1 L = 0.264172 gal (US)"},{from:"gallon_us",to:"liter",fromVal:1,label:"1 gal (US) = 3.78541 L"},{from:"milliliter",to:"fluid_ounce",fromVal:1,label:"1 mL = 0.033814 fl oz"},{from:"cup",to:"milliliter",fromVal:1,label:"1 cup = 236.588 mL"}],area:[{from:"square_meter",to:"square_foot",fromVal:1,label:"1 m² = 10.7639 ft²"},{from:"hectare",to:"acre",fromVal:1,label:"1 ha = 2.47105 acres"},{from:"square_kilometer",to:"square_mile",fromVal:1,label:"1 km² = 0.386102 mi²"},{from:"acre",to:"square_meter",fromVal:1,label:"1 acre = 4046.86 m²"}],speed:[{from:"kilometer_per_hour",to:"mile_per_hour",fromVal:1,label:"1 km/h = 0.621371 mph"},{from:"meter_per_second",to:"kilometer_per_hour",fromVal:1,label:"1 m/s = 3.6 km/h"},{from:"mile_per_hour",to:"kilometer_per_hour",fromVal:60,label:"60 mph = 96.56 km/h"},{from:"knot",to:"kilometer_per_hour",fromVal:1,label:"1 kn = 1.852 km/h"}],time:[{from:"hour",to:"minute",fromVal:1,label:"1 hr = 60 min"},{from:"day",to:"hour",fromVal:1,label:"1 day = 24 hr"},{from:"week",to:"day",fromVal:1,label:"1 week = 7 days"},{from:"year",to:"day",fromVal:1,label:"1 year = 365 days"}],data:[{from:"megabyte",to:"gigabyte",fromVal:1024,label:"1024 MB = 1 GB"},{from:"gigabyte",to:"terabyte",fromVal:1024,label:"1024 GB = 1 TB"},{from:"kilobyte",to:"megabyte",fromVal:1024,label:"1024 KB = 1 MB"},{from:"byte",to:"kilobyte",fromVal:1024,label:"1024 B = 1 KB"}]};let o="length";const a={length:"Chuyển đổi giữa các đơn vị độ dài như mét, kilômét, dặm, feet...",weight:"Chuyển đổi giữa các đơn vị khối lượng như kilôgam, pound, ounce...",temperature:"Chuyển đổi giữa Celsius, Fahrenheit và Kelvin",volume:"Chuyển đổi giữa các đơn vị thể tích như lít, gallon, mililít...",area:"Chuyển đổi giữa các đơn vị diện tích như mét vuông, hecta, acre...",speed:"Chuyển đổi giữa các đơn vị tốc độ như km/h, mph, m/s...",time:"Chuyển đổi giữa giây, phút, giờ, ngày, tuần, năm...",data:"Chuyển đổi giữa các đơn vị dung lượng dữ liệu như byte, KB, MB, GB..."};function m(){const e=t[o],n=document.getElementById("from-unit"),m=document.getElementById("to-unit");n.innerHTML="",m.innerHTML="",Object.entries(e.units).forEach(([e,t])=>{const o=new Option(t.name,e),a=new Option(t.name,e);n.add(o),m.add(a)});Object.keys(e.units).length>1&&(m.selectedIndex=1);const r=document.getElementById("category-info");r&&(r.textContent=a[o])}function r(){const n=document.getElementById("from-unit").value,a=document.getElementById("to-unit").value,m=parseFloat(document.getElementById("from-value").value);if(isNaN(m))return void(document.getElementById("to-value").value="");const r=t[o];let c;if("temperature"===o)c=r.convert(m,n,a);else{c=m*r.units[n].factor/r.units[a].factor}const u=l(c);document.getElementById("to-value").value=u,function(e,n,a,m){const r=t[o],i=r.units[n].name.split("(")[0].trim(),c=r.units[m].name.split("(")[0].trim(),u=document.getElementById("formula-display"),s=document.getElementById("conversion-formula");u.textContent=`${l(e)} ${i} = ${l(a)} ${c}`,s.style.display="block"}(m,n,c,a),function(n,a,m,r){const l=t[o],c={category:o,categoryName:l.name,fromValue:n,fromUnit:a,fromUnitName:l.units[a].name,toValue:m,toUnit:r,toUnitName:l.units[r].name,timestamp:(new Date).toLocaleString("vi-VN")};e.unshift(c),e.length>50&&(e=e.slice(0,50));saveToLocalStorage("conversionHistory",e),i()}(m,n,c,a)}function l(e){return Math.abs(e)<1e-6&&0!==e||Math.abs(e)>1e9?e.toExponential(6):Math.abs(e)<.01&&0!==e?e.toFixed(8).replace(/\.?0+$/,""):e.toFixed(6).replace(/\.?0+$/,"")}function i(){const t=document.getElementById("conversion-history");0!==e.length?t.innerHTML=e.slice(0,10).map((e,t)=>`\n            <div class="history-item" onclick="window.applyHistoryItem(${t})">\n                <div>\n                    <strong>${l(e.fromValue)}</strong> ${e.fromUnitName.split("(")[0].trim()}\n                    → <strong>${l(e.toValue)}</strong> ${e.toUnitName.split("(")[0].trim()}\n                </div>\n                <small>${e.categoryName} • ${e.timestamp}</small>\n            </div>\n        `).join(""):t.innerHTML='<p class="text-muted text-center">Chưa có lịch sử chuyển đổi</p>'}function c(){const e=document.getElementById("common-conversions"),t=n[o]||[];0!==t.length?e.innerHTML=t.map((e,t)=>`\n            <div class="common-conversion-item" onclick="window.applyCommonConversion(${t})">\n                <i class="fas fa-arrow-right text-primary"></i> ${e.label}\n            </div>\n        `).join(""):e.innerHTML='<p class="text-muted text-center">Không có chuyển đổi phổ biến</p>'}function u(){document.getElementById("from-value").value="1";const e=Object.keys(t[o].units);document.getElementById("from-unit").value=e[0],document.getElementById("to-unit").value=e[1]||e[0],r()}m(),c(),i(),window.applyHistoryItem=function(t){const n=e[t];n.category!==o&&(o=n.category,document.getElementById("category-selector").value=o,m(),c()),document.getElementById("from-unit").value=n.fromUnit,document.getElementById("to-unit").value=n.toUnit,document.getElementById("from-value").value=n.fromValue,r()},window.applyCommonConversion=function(e){const t=n[o][e];document.getElementById("from-unit").value=t.from,document.getElementById("to-unit").value=t.to,document.getElementById("from-value").value=t.fromVal,r()},document.getElementById("category-selector").addEventListener("change",function(){o=this.value,m(),c(),u()}),document.getElementById("from-unit").addEventListener("change",r),document.getElementById("to-unit").addEventListener("change",r),document.getElementById("from-value").addEventListener("input",r),document.getElementById("swap-units-btn").addEventListener("click",function(){const e=document.getElementById("from-unit").value,t=document.getElementById("to-unit").value,n=document.getElementById("from-value").value,o=document.getElementById("to-value").value;document.getElementById("from-unit").value=t,document.getElementById("to-unit").value=e,document.getElementById("from-value").value=o||n,r()}),document.getElementById("reset-converter-btn").addEventListener("click",u),document.getElementById("copy-result-btn").addEventListener("click",function(){const e=document.getElementById("to-value").value;e?navigator.clipboard.writeText(e).then(()=>{showAlert("Đã sao chép kết quả!","success")}).catch(()=>{showAlert("Không thể sao chép!","error")}):showAlert("Không có kết quả để sao chép!","warning")}),document.getElementById("clear-history-btn").addEventListener("click",function(){0!==e.length&&confirm("Bạn có chắc muốn xóa lịch sử chuyển đổi?")&&(e=[],saveToLocalStorage("conversionHistory",e),i(),showAlert("Đã xóa lịch sử!","success"))}),r()});